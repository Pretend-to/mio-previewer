# KaTeX 定界符支持文档

`katexPlugin` 支持所有常见的 LaTeX 数学公式定界符。

## 支持的定界符

插件按以下优先级处理定界符（长定界符优先匹配）：

| 定界符 | 类型 | 显示模式 | 示例 |
|--------|------|----------|------|
| `$$...$$` | 块级 | display | 独立行，居中显示 |
| `\[...\]` | 块级 | display | 独立行，居中显示 |
| `\(...\)` | 行内 | inline | 文本中内嵌 |
| `$...$` | 行内 | inline | 文本中内嵌 |

## 使用示例

### 1. 块级公式 - `$$...$$`

**Markdown 源码**:
```markdown
$$
E = mc^2
$$
```

**用途**: 最常用的块级公式语法，来自 Markdown 扩展。

**示例**:
```markdown
$$
\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

$$
\sum_{n=1}^{\infty} \frac{1}{n^2} = \frac{\pi^2}{6}
$$

$$
\begin{bmatrix}
a & b \\
c & d
\end{bmatrix}
$$
```

### 2. 块级公式 - `\[...\]`

**Markdown 源码**:
```markdown
\[
a^2 + b^2 = c^2
\]
```

**用途**: 标准 LaTeX 块级公式语法。

**示例**:
```markdown
\[
f(x) = \int_{-\infty}^{x} e^{-t^2} dt
\]

\[
\lim_{n \to \infty} \left(1 + \frac{1}{n}\right)^n = e
\]
```

### 3. 行内公式 - `\(...\)`

**Markdown 源码**:
```markdown
欧拉公式: \(e^{i\pi} + 1 = 0\)
```

**用途**: 标准 LaTeX 行内公式语法，适合在文本中使用。

**示例**:
```markdown
圆的面积公式为 \(A = \pi r^2\)，其中 \(r\) 是半径。

在物理学中，动能表达式为 \(KE = \frac{1}{2}mv^2\)。

根据欧拉恒等式 \(e^{i\pi} + 1 = 0\)，可以看出...
```

### 4. 行内公式 - `$...$`

**Markdown 源码**:
```markdown
质能方程: $E = mc^2$
```

**用途**: 最常用的行内公式语法，来自 Markdown 扩展。

**示例**:
```markdown
勾股定理: $a^2 + b^2 = c^2$

二次方程求根公式: $x = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$

黄金比例: $\phi = \frac{1 + \sqrt{5}}{2}$
```

## 混合使用示例

您可以在同一文档中混合使用不同的定界符：

```markdown
# 数学公式演示

## 行内公式

使用 `$...$` 语法：质能方程 $E = mc^2$ 是最著名的公式之一。

使用 `\(...\)` 语法：圆的面积为 \(A = \pi r^2\)。

## 块级公式

使用 `$$...$$` 语法：

$$
\int_0^1 x^2 dx = \frac{1}{3}
$$

使用 `\[...\]` 语法：

\[
\nabla \times \mathbf{E} = -\frac{\partial \mathbf{B}}{\partial t}
\]
```

## 转义和特殊情况

### 转义定界符

如果需要在文本中显示定界符本身而不触发公式渲染，使用反斜杠转义：

```markdown
显示美元符号：\$ 不是公式起始符

显示反斜杠括号：\\( 和 \\) 不会触发公式
```

### 空白内容

空白或仅包含空格的公式内容会被忽略，不会渲染：

```markdown
$$ $$ 这个不会渲染

$   $ 这个也不会渲染
```

### 多行块级公式

块级公式支持多行内容：

```markdown
$$
\begin{aligned}
f(x) &= (x+1)^2 \\
     &= x^2 + 2x + 1 \\
     &= x^2 + 2x + 1
\end{aligned}
$$
```

或使用 `\[...\]`：

```markdown
\[
\begin{cases}
x + y = 5 \\
2x - y = 1
\end{cases}
\]
```

## 优先级说明

定界符按长度优先匹配，这意味着：

1. **`$$` 优先于 `$`**: 
   - `$$x^2$$` 会被解析为块级公式，而不是两个独立的 `$`

2. **`\[` 和 `\(` 不冲突**: 
   - 因为后续字符不同（`[` vs `(`），所以可以明确区分

3. **建议的最佳实践**:
   - 块级公式使用 `$$...$$`（Markdown 风格）
   - 行内公式使用 `$...$`（Markdown 风格）
   - 如果需要严格遵循 LaTeX 标准，使用 `\[...\]` 和 `\(...\)`

## 常见错误和解决方案

### 问题 1: 美元符号被误解析

```markdown
这个商品价格是 $100，折扣后是 $80。
```

**问题**: `$100，折扣后是 $` 会被解析为公式。

**解决方案**: 使用转义或调整语法
```markdown
这个商品价格是 \$100，折扣后是 \$80。
```

或者使用行内代码：
```markdown
这个商品价格是 `$100`，折扣后是 `$80`。
```

### 问题 2: 复杂公式渲染错误

```markdown
$x = \frac{-b \pm \sqrt{b^2-4ac}{2a}$
```

**问题**: 缺少右花括号。

**解决方案**: 检查 LaTeX 语法
```markdown
$x = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$
```

### 问题 3: 块级公式缩进问题

```markdown
  $$
  E = mc^2
  $$
```

**问题**: 前导空格可能导致解析问题。

**解决方案**: 确保 `$$` 从行首开始
```markdown
$$
E = mc^2
$$
```

## 性能考虑

- **优先使用简短定界符**: `$...$` 和 `$$...$$` 解析速度更快
- **避免嵌套**: 公式定界符不支持嵌套使用
- **大型公式**: 对于特别复杂的公式，建议使用块级格式以提高可读性

## 与其他 Markdown 扩展的兼容性

`katexPlugin` 设计为与其他 markdown-it 插件兼容：

- ✅ 与代码块（````）兼容 - 代码块内的定界符不会被解析
- ✅ 与行内代码（`` ` ``）兼容 - 行内代码中的定界符不会被解析
- ✅ 与 HTML 注释兼容 - 注释中的定界符不会被解析
- ✅ 与链接/图片兼容 - 可以在链接文本中使用公式

示例：
```markdown
行内代码中的 `$x^2$` 不会渲染为公式。

代码块中的也不会：
\`\`\`
$$
E = mc^2
$$
\`\`\`

但普通文本中的 $x^2$ 会渲染。
```

## 参考资源

- [KaTeX 支持的函数列表](https://katex.org/docs/supported.html)
- [KaTeX 语法参考](https://katex.org/docs/support_table.html)
- [LaTeX 数学符号](https://www.latex-project.org/)

---

**提示**: 如果公式渲染出现错误，检查 KaTeX 的错误提示（通常以红色显示），它会指出具体的语法问题。
